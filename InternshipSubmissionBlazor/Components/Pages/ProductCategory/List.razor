@page "/categories"
@using Services.Features.ProductCategory.Delete.Contracts
@using Services.Features.ProductCategory.Get.Contracts
@using Services.Features.ProductCategory.Get.Contracts.DTOs
@rendermode InteractiveServer
@attribute [StreamRendering]
@inject IGetProductCategoriesFeature _getProductCategoriesFeature
@inject IDeleteProductCategoryFeature _deleteProductCategoryFeature
@inject NavigationManager Nav

<PageTitle>Unit Price</PageTitle>

<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box">
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Categories</a></li>
                    <li class="breadcrumb-item active">List</li>
                </ol>
            </div>
            <h4 class="page-title">
                <NavLink class="btn btn-primary" href="/categories/create">Create</NavLink>
            </h4>
        </div>
    </div>
</div>     
<!-- end page title --> 

<table class="table table-striped table-centered mb-0">
    <thead>
        <tr>
            <th>Order No</th>
            <th>Category Code</th>
            <th>Category Name</th>
            <th>Notes</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @if (ProductCategories == null)
        {
            <p>
                <em>Loading...</em>
            </p>
        }
        else if (ProductCategories.Count > 0)
        {
            @foreach (var (item, index) in ProductCategories.Select((x, i) => (x, i)))
            {
                <tr>
                    <td>@item.OrderNo</td>
                    <td>@item.CategoryCode</td>
                    <td>@item.CategoryName</td>
                    <td>@item.Notes</td>
                    <td class="table-action">
                        <NavLink class="action-icon"
                                @onclick="() => UpdateProductCategory(item.Id)"> <i class="mdi mdi-pencil"></i></NavLink>
                        <NavLink class="action-icon"
                                 @onclick="() => DeleteProductCategory(item.Id)"> <i class="mdi mdi-delete"></i></NavLink>
                    </td>
                </tr>
            }
        }
        else
        {
            <p>
                <em>No elements.</em>
            </p>
        }
    </tbody>
</table>

@code {
    public List<ProductCategoryDTO>? ProductCategories { get; set; } = null;

    protected override async Task OnInitializedAsync()
    {
        ProductCategories = await _getProductCategoriesFeature.GetProductCategoriesAsync();
    }

    private async Task DeleteProductCategory(Guid unitId)
    {
        await _deleteProductCategoryFeature.DeleteAsync(unitId);
        ProductCategories = await _getProductCategoriesFeature.GetProductCategoriesAsync();
        StateHasChanged();
    }

    private async Task UpdateProductCategory(Guid unitId)
    {
        Nav.NavigateTo($"/categories/update/{unitId}");
    }
}